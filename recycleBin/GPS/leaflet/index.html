<!DOCTYPE html>
<html lang="en">
<head>
	<base target="_top">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title> Where? </title>
	
	<link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" />

    <link rel="stylesheet" href="./leaflet.css"/>
    <script src="./leaflet.js"></script>

	<style>
		body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }
	</style>
	
</head>
<body>
<div id="map"></div>
<script>
	const LAT_INIT = 38.0;
	const LON_INIT = -105.0;
	const default_zoom = 5;
	const host = "127.0.0.1";
	const port = 6969;
	const base_layer = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';
	const attriburtion = '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';
	var socket;

	var tiles = L.tileLayer(base_layer, { maxZoom: 19, attribution: attriburtion });
	var map = L.map('map', {
		center: [LAT_INIT, LON_INIT],
		zoom: default_zoom,
		layers: [tiles]
	});

	var baseLayers = {
		'Base Map': tiles
	};

	var overlays = {};
	var paths = [];
	for(let i = 0; i < 30; ++i) {
		paths.push(L.polyline([], {color: "red"}));
		overlays[i.toString()] = paths[i];
	}

	var layerControl = L.control.layers(baseLayers, overlays).addTo(map);

	function handleWSInput(event){
		
		tuples = event.data.split(",");

		id = Number(tuples[0]);
		lat = Number(tuples[1]);
		lon = Number(tuples[2]);
		time = tuples[3];
		
		if(paths[id].getLatLngs().length < 3) {
			paths[id].addLatLng(L.latLng(lat, lon));
			return;
		}

		if(paths[id].getLatLngs().length == 3) {
			paths[id].setLatLngs([]);
			paths[id].addLatLng(L.latLng(lat, lon));
			return;
		}	

	}

	socket = new WebSocket("ws://127.0.0.1:6969");
	socket.addEventListener("open", (event) => {
		console.log(event);
		sendBds();
	});
	socket.addEventListener("close", (event) => {
		console.log(event);
	});
	socket.addEventListener("message", handleWSInput);

	var south_west = L.latLng(-90.0, -180.0);
	var north_east = L.latLng(90.0, 180.0);
	map.setMaxBounds(L.latLngBounds(south_west, north_east));

	
</script>
</div>

</body>
</html>